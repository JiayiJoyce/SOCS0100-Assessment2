<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Interactive_report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Interactive_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="Interactive_report_files/libs/quarto-html/quarto.js"></script>
<script src="Interactive_report_files/libs/quarto-html/popper.min.js"></script>
<script src="Interactive_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Interactive_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="Interactive_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Interactive_report_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Interactive_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Interactive_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Interactive_report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Interactive_report</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="part-i" class="level2">
<h2 class="anchored" data-anchor-id="part-i">Part I</h2>
<div class="cell" data-context="setup">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check whether groundhog is installed on the computer, install if not. Remove # to install</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"groundhog"</span>)) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"groundhog"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spotifyr"</span>, <span class="co">#wrapper for spotify API</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"purrr"</span>, <span class="co">#for static data scraping</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"xml2"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rvest"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"robotstxt"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>,<span class="co">#for data wrangling</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dplyr"</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"countrycode"</span>,<span class="co">#for data visualisation</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"plotly"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tibble"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggplot2"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"janitor"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gifski"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kableExtra"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fmsb"</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gganimate"</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"shinyanimate"</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">groundhog.library</span>(pkgs, <span class="st">"2024-01-04"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="a.-automated-data-collection" class="level3">
<h3 class="anchored" data-anchor-id="a.-automated-data-collection">A. Automated data collection</h3>
<p>In this assignment I aim to analyze the current trend of popular music in dominant music markets across the globe according to the latest <a href="https://en.wikipedia.org/wiki/List_of_largest_recorded_music_markets">International Federation of the Phonographic Industry (IFPI) report</a>. A static scraping is performed on Wikipedia to obtain annual data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2.static scraping annual IFPI data from 2011 to 2017</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If the website allows scraping, then proceed scraping, else print error message</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">paths_allowed</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_largest_recorded_music_markets"</span>)){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function that enables parsing multiple tables automatically on wikipedia</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  parse_annual_data_tables <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_largest_recorded_music_markets"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    parsed <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    annual_data_tables <span class="ot">&lt;-</span> <span class="fu">html_element</span>(parsed, <span class="at">xpath =</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">'//*[@id="mw-content-text"]/div[1]/table['</span>,x,<span class="st">']'</span>)) <span class="co">#the only changing part is the number of the table, which is arranged in yearly order</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    IFPI_data <span class="ot">&lt;-</span> <span class="fu">html_table</span>(annual_data_tables)   </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(IFPI_data)}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#since the table on 2011-17 data ranges from table 6 to table 12, they will be scraped and binded</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  original_IFPI_data <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>, parse_annual_data_tables)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="fu">print</span>(<span class="st">"Sorry, the page is not scrapable now.There may be a change in the website settings."</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#export the data to csv format</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(original_IFPI_data,<span class="st">"140123original_IFPI_data.csv"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I then collect music-related data through Spotify API as it offers an interface to relevant databases, which include up to date popular playlists and data on relevant audio features. Furthermore, the <a href="https://www.rcharlie.com/spotifyr/">spotifyr</a> package provided a wrapper which made it easier for me to integrate the API output.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The scraping code chunks are disabled as they require private API key to run. Data wrangling and visualization will be based on data scrapped on 14 Jan 2023.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#3.Using spotifyr to access API and scrape top hits from top 6 countries----</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#creating a variable called access token----</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">SPOTIFY_CLIENT_ID =</span> <span class="st">'paste your own client id here'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">SPOTIFY_CLIENT_SECRET =</span> <span class="st">'paste your own client secret here'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>access_token <span class="ot">&lt;-</span> <span class="fu">get_spotify_access_token</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#scraping top hits----</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>UKtophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbLnolsZ8PSNw'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>KRtophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbNxXF4SkHj9F'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>UStophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbLRQDuF5jeBp'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>JPtophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbKXQ4mDTEBXq'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>DEtophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbJiZcmkrIHGU'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>FRtophits<span class="ot">&lt;-</span><span class="fu">get_playlist_audio_features</span>(<span class="st">'paste your own spotify user id here'</span>,<span class="st">'37i9dQZEVXbIPWwFssbupI'</span>,<span class="at">authorization =</span> <span class="fu">get_spotify_access_token</span>())</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#bind the top hits from 6 countries into one dataframe called tophits</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>tophits<span class="ot">&lt;-</span><span class="fu">bind_rows</span>(UKtophits,KRtophits,UStophits,JPtophits,DEtophits,FRtophits)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#exporting tophits as scraped on 14 Jan 2024 for future reproducibility</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(tophits,<span class="st">"140123tophits.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="b.-data-exploration-contextualisation" class="level3">
<h3 class="anchored" data-anchor-id="b.-data-exploration-contextualisation">B. Data Exploration &amp; Contextualisation</h3>
<p>First, I import the scrapped data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>original_IFPI_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"140123original_IFPI_data.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>original_tophits <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"140123tophits.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data wrangling aims to</p>
<ol type="1">
<li><p>standardize country name for cross comparison</p></li>
<li><p>turn character vectors into numeric vectors for visualisation</p></li>
<li><p>remove unnecessary columns</p></li>
<li><p>clean headers for machine readability</p></li>
</ol>
<p>IFPI data requires more tidying as webscraping is site-dependent: the data is less structured.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#adding year column to the IFPI data. The year was not incuded when scraping as they were not part of the table on the webpage</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>year_len <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>original_IFPI_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">2017</span>, <span class="dv">1</span> <span class="sc">+</span> <span class="fu">nrow</span>(original_IFPI_data) <span class="sc">%/%</span> year_len), <span class="at">each =</span> year_len, <span class="at">length.out =</span> <span class="fu">nrow</span>(original_IFPI_data))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#removing `% Change` column, which is all NA</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data <span class="ot">&lt;-</span> original_IFPI_data <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="st">`</span><span class="at">% Change</span><span class="st">`</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#removing "," from the `Retail valueUS$ (millions)` column to convert it to numeric value</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data<span class="sc">$</span><span class="st">`</span><span class="at">Retail valueUS$ (millions)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">','</span>, <span class="st">''</span>, wrangled_IFPI_data<span class="sc">$</span><span class="st">`</span><span class="at">Retail valueUS$ (millions)</span><span class="st">`</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data<span class="sc">$</span><span class="st">`</span><span class="at">Retail valueUS$ (millions)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(wrangled_IFPI_data<span class="sc">$</span><span class="st">`</span><span class="at">Retail valueUS$ (millions)</span><span class="st">`</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#tidying observations----</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#fix NA</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>remove_percentage_sign_fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">'%'</span>, <span class="st">''</span>, x)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> <span class="st">"n/a"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#apply the remove_percentage_sign function to the following columns: Physical, Digital, Performance Rights, Synchronization </span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)], remove_percentage_sign_fix_missing)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning names----</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#use janitor to clean the column names</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(wrangled_IFPI_data)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">#standardize the country names using countrycode package</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data<span class="sc">$</span>market <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"[A-Za-z]"</span>, wrangled_IFPI_data<span class="sc">$</span>market),  <span class="co"># Check if there are letters</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_IFPI_data<span class="sc">$</span>market, <span class="at">origin =</span> <span class="st">'country.name'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_IFPI_data<span class="sc">$</span>market, <span class="at">origin =</span> <span class="st">'iso2c'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># subsetting global data (NA after standardinsing country names) to a new dataset----</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>global_IFPI_data <span class="ot">&lt;-</span> wrangled_IFPI_data <span class="sc">%&gt;%</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(market))<span class="sc">%&gt;%</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year,retail_value_us_millions)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#change the retail_value_us_millions column to numeric</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>global_IFPI_data<span class="sc">$</span>retail_value_us_millions <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(global_IFPI_data<span class="sc">$</span>retail_value_us_millions)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#change the year column to character</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>global_IFPI_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.character</span>(global_IFPI_data<span class="sc">$</span>year)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># turning character to numerics for data visualisation----</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co">#change column 4-7 to numeric, and then adding 'percentage' to the end of column 4-7</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)], as.numeric)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wrangled_IFPI_data)[<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">colnames</span>(wrangled_IFPI_data)[<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>],<span class="st">' percentage'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co">#remove the NA rows (global data is already subsetted)</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data <span class="ot">&lt;-</span> wrangled_IFPI_data[<span class="sc">!</span><span class="fu">is.na</span>(wrangled_IFPI_data<span class="sc">$</span>market),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the end, I produced a tidied data frame: <code>wrangled_IFPI_data</code>.</p>
<p>Data from the Spotify API is more tidy and comprehensive. Tidying it is mainly to remove unnecessary columns and stardardize column names.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select the columns that are needed for analysis</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>wrangled_tophits <span class="ot">&lt;-</span> original_tophits <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(playlist_name, danceability, energy, key, loudness,speechiness, acousticness, instrumentalness, liveness, valence, tempo, track.explicit, track.popularity, track.name)<span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country =</span> playlist_name)<span class="co">#rename the playlist_name column to country</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove the "Top 50 -  "from the country column</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Top 50 - "</span>, <span class="st">""</span>, wrangled_tophits<span class="sc">$</span>country)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#standardize the country names using countrycode package</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"[A-Za-z]"</span>, wrangled_tophits<span class="sc">$</span>country),  <span class="co"># Check if there are letters</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'country.name'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'iso2c'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The end product is a tidied dataframe: <code>wrangled_tophits</code>.</p>
<section id="overview-of-datasets" class="level5">
<h5 class="anchored" data-anchor-id="overview-of-datasets">Overview of datasets</h5>
<p>The <code>wrangled_IFPI_data</code> dataframe contains the value of music markets in different countries from 2011 to 2017, with 8 columns and 77 rows. It showcases the percentage of different facets of the music market (<code>physical</code>, <code>digital</code>, <code>performance rights</code>) in countries with leading market sizes and therefore have implications in the study of the concentration of the media <span class="citation" data-cites="geurts2023">(<a href="#ref-geurts2023" role="doc-biblioref">Geurts and Cepa 2023</a>)</span>in social science.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rank</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">market</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">retail_value_us_millions</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">physical percentage</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">digital percentage</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">performance_rights percentage</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">synchronization percentage</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 1.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Length:70</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 211.3</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 3.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :14.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 0.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :2011</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: 3.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Class :character</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: 293.2</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:32.50</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:25.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: 6.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:1.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:2012</td>
</tr>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : 5.5</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mode :character</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : 658.2</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :43.50</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :38.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : 9.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :2.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :2014</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean : 5.5</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :1325.6</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :46.67</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :40.43</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :11.1</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :1.786</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :2014</td>
</tr>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.: 8.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:1362.3</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:62.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:55.50</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:14.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:2.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:2016</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :10.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :5916.1</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :80.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :90.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :37.0</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :4.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :2017</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The <code>wrangled_tophits</code> dataframe contains the audio features (including <code>valence</code>, <code>dancability</code>, etc.) of the top 50 songs in 6 countries, with 14 columns and 300 rows. Most of these audio features are numeric and rated from 0-1, making it easy for cross comparison. Others, such as <code>track.explicit</code> and <code>track.name</code> are logical or characters. It provide an up-to-date insight on the musical taste, an important cultural aspect<span class="citation" data-cites="aarons2018">(<a href="#ref-aarons2018" role="doc-biblioref">Aarons 2018</a>)</span>, in countries with the most developed music industry.</p>
<p>Detailed deinition of variables on audio features by the official Spotify API site can be found <a href="https://developer.spotify.com/documentation/web-api/reference/get-audio-features">here</a></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">danceability</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">energy</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">loudness</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">speechiness</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">acousticness</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">instrumentalness</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">liveness</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">valence</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">tempo</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">track.explicit</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">track.popularity</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">track.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Length:300</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.2790</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.0911</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 0.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :-17.665</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.02510</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.0000277</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.0000000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.0517</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. :0.0743</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 72.49</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mode :logical</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Min. : 39.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Length:300</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Class :character</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.5450</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.5580</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: 2.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: -7.390</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.03905</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.0447000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.0000000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.1020</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:0.3237</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.:104.98</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">FALSE:189</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">1st Qu.: 74.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Class :character</td>
</tr>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mode :character</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.6590</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.6780</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : 5.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : -6.010</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.05895</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.1685000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.0000014</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.1195</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :0.5240</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median :126.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">TRUE :111</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Median : 80.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mode :character</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.6516</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.6696</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean : 5.273</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean : -6.150</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.10477</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.2418359</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.0137790</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.1843</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :0.5097</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean :126.11</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Mean : 80.58</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.7670</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.7930</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.: 9.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.: -4.545</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.14250</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.3547500</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.0000691</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.2285</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:0.6817</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.:144.28</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">3rd Qu.: 90.25</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;"></td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.9590</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.9870</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :11.000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. : -0.425</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.53600</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.9690000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.8360000</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.8420</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :0.9670</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :203.76</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">Max. :100.00</td>
<td style="text-align: left; color: orchid !important; background-color: aliceblue !important;">NA</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
</section>
<section id="part-ii" class="level2">
<h2 class="anchored" data-anchor-id="part-ii">Part II</h2>
<section id="a.-interactive-visualisations" class="level3">
<h3 class="anchored" data-anchor-id="a.-interactive-visualisations">A. Interactive visualisations</h3>
<p>The following diagram is suitable for showcasing whether specific audio features correlates with <code>popularity</code> under different cultural contexts. Each observation is one of the <code>Top 50 hit songs</code>. Upon hovering, specific name of the song that makes up the datapoints is shown.</p>
<ul>
<li><p>It is note worthy that Asian countries, such as Japan and South Korea, have a lot less explicit songs in their top 50 list compared to European and American countries.</p></li>
<li><p>Further analysis about correlation can be built upon this,although upon glance tophits in Japan are highly concentrated interms of popularity- most fall between the 70-80 range, while similar phenomenon isn’t observed elsewhere.</p></li>
</ul>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input for scatter plot</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">radioButtons</span>(<span class="st">"country_buttons"</span>, <span class="at">label =</span> <span class="fu">h3</span>(<span class="st">"Select country to view audio features"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">choices =</span> <span class="fu">unique</span>(wrangled_tophits<span class="sc">$</span>country),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">selected =</span> <span class="st">"France"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="country_buttons" class="form-group shiny-input-radiogroup shiny-input-container" role="radiogroup" aria-labelledby="country_buttons-label">
<label class="control-label" id="country_buttons-label" for="country_buttons">
<h3 class="anchored">Select country to view audio features</h3>
</label>
<div class="shiny-options-group">
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="United Kingdom">
<span>United Kingdom</span>
</label>
</div>
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="South Korea">
<span>South Korea</span>
</label>
</div>
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="United States">
<span>United States</span>
</label>
</div>
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="Japan">
<span>Japan</span>
</label>
</div>
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="Germany">
<span>Germany</span>
</label>
</div>
<div class="radio">
<label>
<input type="radio" name="country_buttons" value="France" checked="checked">
<span>France</span>
</label>
</div>
</div>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">selectInput</span>(<span class="st">"Yvar"</span>, <span class="at">label =</span> <span class="fu">h3</span>(<span class="st">"Select variable for y-axis"</span>), </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="fu">names</span>(wrangled_tophits)[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">10</span>)], </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="Yvar-label" for="Yvar">
<h3 class="anchored">Select variable for y-axis</h3>
</label>
<div>
<select id="Yvar" class="shiny-input-select"><option value="danceability">danceability</option>
<option value="energy">energy</option>
<option value="speechiness">speechiness</option>
<option value="liveness">liveness</option>
<option value="valence">valence</option></select>
<script type="application/json" data-for="Yvar" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="cell panel-fill">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotlyOutput</span>(<span class="st">'audio_features'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-widget-output shiny-report-size shiny-report-theme html-fill-item" id="audio_features" style="width:100%;height:400px;"></div>
</div>
</div>
</div>
</div>
</div>
<p>The following radar diagram provides a direct holistic comparison between the avearage of essential audio features of top 50 songs in the six countries. Radargraph is choosen because the five variables are all rated on the same scale (from 0-1) by spotify.</p>
<ul>
<li><p>Popular songs in Japan is weakest in terms of <code>energy</code> and <code>valence</code>. This provide grounds for future research regarding the Cultual difference.</p></li>
<li><p>Unlike plotly, <code>fmsb</code> pacakge that generates radarchart does not contain download feature, so I wrote a link for download below the graph.</p></li>
</ul>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input for radar plot</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">selectInput</span>(<span class="st">"radar_country"</span>, <span class="at">label =</span> <span class="fu">h3</span>(<span class="st">"Select a country to view mean audio features"</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="fu">unique</span>(wrangled_tophits<span class="sc">$</span>country), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">selected =</span> <span class="st">"Japan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display no-overflow-x">
<div class="form-group shiny-input-container">
<label class="control-label" id="radar_country-label" for="radar_country">
<h3 class="anchored">Select a country to view mean audio features</h3>
</label>
<div>
<select id="radar_country" class="shiny-input-select"><option value="United Kingdom">United Kingdom</option>
<option value="South Korea">South Korea</option>
<option value="United States">United States</option>
<option value="Japan" selected="">Japan</option>
<option value="Germany">Germany</option>
<option value="France">France</option></select>
<script type="application/json" data-for="radar_country" data-nonempty="">{"plugins":["selectize-plugin-a11y"]}</script>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="cell panel-fill">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotOutput</span>(<span class="st">'radar_chart'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="shiny-plot-output html-fill-item" id="radar_chart" style="width:100%;height:400px;"></div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadLink</span>(<span class="st">"downloadRadar"</span>, <span class="st">"Download Radar Chart for your choosen country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<a id="downloadRadar" class="shiny-download-link" href="" target="_blank" download="">Download Radar Chart for your choosen country</a>
</div>
</div>
</div>
</div>
</div>
<p>This diagram shows changes in major music markets and their level of digitization.</p>
<ul>
<li><p>It showcased that while US and Japan has two of the largest music markets, they operate in drastically different trends.</p></li>
<li><p>During the process of digitizaiton, US’s market continued to grow in size drastically, as showcased by the size of the pink dot.</p></li>
<li><p>While US is rapidly digitizing during 2011-2017, Japan’s market remained highly physical.</p></li>
<li><p>This indicates that top hits collected from Spotify, an on-line platform, may not be representative of the average music taste in Japan.</p></li>
</ul>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"yearslider"</span>, <span class="at">label =</span> <span class="fu">h3</span>(<span class="st">"Select year"</span>), <span class="at">min =</span> <span class="dv">2011</span>, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> <span class="dv">2017</span>, <span class="at">value =</span> <span class="dv">2011</span>,<span class="at">round =</span> <span class="cn">TRUE</span>,<span class="at">sep =</span> <span class="st">""</span>,<span class="at">animate =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="yearslider-label" for="yearslider">
<h3 class="anchored">Select year</h3>
</label>
<input class="js-range-slider" id="yearslider" data-skin="shiny" data-min="2011" data-max="2017" data-from="2011" data-step="1" data-grid="true" data-grid-num="6" data-grid-snap="false" data-prettify-separator="" data-prettify-enabled="false" data-keyboard="true" data-data-type="number">
<div class="slider-animate-container">
<a href="#" class="slider-animate-button" data-target-id="yearslider" data-interval="1000" data-loop="FALSE">
<span class="play">
<i aria-label="play icon" class="glyphicon glyphicon-play" role="presentation"></i>
</span>
<span class="pause">
<i aria-label="pause icon" class="glyphicon glyphicon-pause" role="presentation"></i>
</span>
</a>
</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="cell panel-fill">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotOutput</span>(<span class="st">'musicmarket'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="shiny-plot-output html-fill-item" id="musicmarket" style="width:100%;height:400px;"></div>
</div>
</div>
</div>
</div>
</div>
<p>The code for an animated version that can be manually activated is attached below, where shadows are added to better showcase the dynamics.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># follow the following steps to view the animation- since animation can't be embedded into rendered dashboard, Manually running it in r studio is needed.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. open the .qmd file in R-studio without rendering it</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. scroll to the bottom and run the server code chunk, ignore the error message- this step is done to import the wrangled data into the environment</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. select and run the following code to view animation in the Viewer panel. It may take around 30 seconds to render.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>IFPI_graph<span class="ot">=</span> wrangled_IFPI_data<span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">physical_percentage</span><span class="st">`</span>, <span class="at">y=</span>digital_percentage,<span class="at">color=</span>market,<span class="at">size=</span>retail_value_us_millions))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Global Music Market from 2011 to 2017"</span>,<span class="at">x=</span><span class="st">"Physical Percentage"</span>,<span class="at">y=</span><span class="st">"Digital Percentage"</span>,<span class="at">size=</span><span class="st">"Total retail Value in US$ millions"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>IFPI_graph.animation<span class="ot">=</span>IFPI_graph<span class="sc">+</span><span class="fu">transition_time</span>(year)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">subtitle=</span><span class="st">"Year: {frame_time}"</span>)<span class="sc">+</span><span class="fu">shadow_wake</span>(<span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(IFPI_graph.animation, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>(),<span class="at">fps=</span><span class="dv">15</span>,<span class="at">duration=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="b.-reproducibility" class="level3">
<h3 class="anchored" data-anchor-id="b.-reproducibility">B. Reproducibility</h3>
<p>Please see the <code>README.md</code> file for further information.</p>
</section>
<section id="c.-critical-engagement-with-ai" class="level3">
<h3 class="anchored" data-anchor-id="c.-critical-engagement-with-ai">C. Critical engagement with AI</h3>
<section id="fixing-package-issues-depends-on-the-popularity-of-the-package" class="level4">
<h4 class="anchored" data-anchor-id="fixing-package-issues-depends-on-the-popularity-of-the-package">1. Fixing package issues: depends on the popularity of the package</h4>
<p>Originally I planned to conduct texual analysis based on lyrics, which requires using the <a href="https://ewenme.github.io/geniusr/">geniusr</a> package. However this package produced an error unspecified by the developer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is ChatGpt's first advice</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The error "replacement has length zero" typically occurs when trying to replace values in a vector or a subset of a vector with another vector, and the replacement vector has zero length. This can happen when the replacement vector is empty or not provided correctly.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In the context of the `geniusr` package and the error message you provided, it seems like there might be an issue with the data returned by the `get_lyrics_search` function. The code may be attempting to assign values to the `section_artist` vector, but the replacement (`artist`) is empty or not available.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's a general approach to troubleshoot and handle such issues:</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. **Check the `get_lyrics_search` Result:**</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    Before attempting to process the data, check the result returned by `get_lyrics_search` to understand what information is available and if it contains the necessary fields.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>   lyrics_data <span class="ot">&lt;-</span> <span class="fu">get_lyrics_search</span>(<span class="st">"Kenya Grace"</span>, <span class="st">"Strangers"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(lyrics_data)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. **Inspect Data Structure:**</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    Examine the structure of `lyrics_data` to ensure it has the expected columns and values. You can use functions like</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lyrics_data) </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lyrics_data) </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># to inspect the data.</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. **Check Variable Names:**</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#    Ensure that the variable names used in your code (e.g., `section_artist`, `artist`) correspond to the actual columns in the data returned by `get_lyrics_search`.</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co"># If the issue persists, you may want to share more details about the code snippet where the error occurs, or check the documentation and examples provided by the `geniusr` package. Additionally, consider reac`hing out to the package's maintainers or community for assistance.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Non of the three solution was specific to the error concerning the package. Upon further questioning it advised me to inspect the validity of my API token:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ChatGPT's second advice</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#It seems like you're referring to a specific R package or library named geniusr that is designed to interact with the Genius API. Based on the information provided, it appears that the library follows a standard process for authenticating and retrieving data from the Genius API.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Up Environment Variable:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up an environment variable named GENIUS_API_TOKEN.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the generated client access token as the value of the environment variable.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># In R, you can set an environment variable using the Sys.setenv() function:</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">GENIUS_API_TOKEN =</span> <span class="st">"your_generated_access_token"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Alternatively, you can set the environment variable outside of your R script or session in your system environment variables.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>which was not the problem as the package was able to perform other functions such as</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my test run of example code in the package</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">search_artist</span>(<span class="st">'taylor swift'</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#output</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 3</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   artist_id artist_name  artist_url                             </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#       &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;                                  </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1      1177 Taylor Swift https://genius.com/artists/Taylor-swift</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># After further research on  [stackoverflow](https://stackoverflow.com/questions/76565068/geniusr-package-problem-with-get-lyrics-function), and running exemplar code on the wrapper's [github page](https://ewenme.github.io/geniusr/), I found that the problem was likely related to changes in API rather than my code, and had to resort to scraping other data source. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ChatGPT didn’t solve the error or identified the infeasibility of the package (it insisted the package was workable). It is not suitable for solving problems related to contextual errors such as the ones related to API changes or less well-known packages.</p>
<p>It did, however, improved my usage of <a href="https://github.com/vincentarelbundock/countrycode">country code package</a> in standardizing country names.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This was my original code based on example code in the country code package</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'country'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>) </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in countrycode(wrangled_tophits$country, origin = "country", destination = "country.name.en") : </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   The `origin` argument must be a string of length 1 equal to one of these values: cctld, country.name, country.name.de, country.name.fr, country.name.it, cowc, cown, dhs, ecb, eurostat, fao, fips, gaul, genc2c, genc3c, genc3n, gwc, gwn, imf, ioc, iso2c, iso3c, iso3n, p5c, p5n, p4c, p4n, un, un_m49, unicode.symbol, unhcr, unpd, vdem, wb, wb_api2c, wb_api3c, wvs, country.name.en.regex, country.name.de.regex, country.name.fr.regex, country.name.it.regex.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This snippet is where ChatGPT correctly identified my mistake in defining origins.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The error you're encountering suggests that the origin argument in the countrycode function is not being provided with a valid value. The origin argument specifies the format of the input country codes, and it must be one of the accepted values.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># In your case, it seems like you want to convert existing country codes in your data (wrangled_tophits$country) to country names in English. To fix this issue, you need to ensure that the origin argument is set correctly.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure to install and load the 'countrycode' package</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("countrycode")</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming your country codes are in ISO2 or ISO3 format</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">countrycode</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  wrangled_tophits<span class="sc">$</span>country,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">origin =</span> <span class="st">'iso2c'</span>,  <span class="co"># or 'iso3c' depending on your data</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">destination =</span> <span class="st">'country.name.en'</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If your 'country' column contains a mix of full country names like "United Kingdom" and country codes like "USA," you may need to use multiple countrycode calls to handle both cases.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's an example that shows how you can use conditional logic to determine the format of each entry and apply the appropriate countrycode conversion:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure to install and load the 'countrycode' package</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("countrycode")</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Example data</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>wrangled_tophits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"United Kingdom"</span>, <span class="st">"USA"</span>, <span class="st">"Canada"</span>, <span class="st">"Germany"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the format of each entry and apply countrycode accordingly</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"[A-Za-z]"</span>, wrangled_tophits<span class="sc">$</span>country),  <span class="co"># Check if there are letters</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'country.name'</span>, <span class="at">destination =</span> <span class="st">'iso2c'</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'iso2c'</span>, <span class="at">destination =</span> <span class="st">'country.name'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wrangled_tophits)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># However,the origin (my scraped dataset) wasn't in iso2c.</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># I further asked CHATgpt to explain each step to me so I can understand its rational</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, I made some slight modifications manually on how destination are defined to ensure consistency</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>wrangled_tophits<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"[A-Za-z]"</span>, wrangled_tophits<span class="sc">$</span>country),  <span class="co"># Check if there are letters</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'country.name'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">countrycode</span>(wrangled_tophits<span class="sc">$</span>country, <span class="at">origin =</span> <span class="st">'iso2c'</span>, <span class="at">destination =</span> <span class="st">'country.name.en'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Overall, whether ChatGPT can be helpful in fixing problems related to packages depends on its popularity. Since <code>Countrycode</code> is a lot more widely used than <code>geniusR</code>, ChatGpt was able to offer helpful solution and explainatory insights. On the other hand, the experience of trying to use it to fix a less popular package is frustrating to say the least.</p>
</section>
<section id="explaination-errors-and-internet-found-solutions-helpful" class="level4">
<h4 class="anchored" data-anchor-id="explaination-errors-and-internet-found-solutions-helpful">2. Explaination: errors and internet found solutions: helpful</h4>
<p>Explaining errors is one of the most useful feature in Chat GPT.</p>
<p>ChatGPT was able to identify the problem as the presence of non-numeric values in the columns</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It appears that your `remove_percentage_sign` function is correctly defined to remove the percentage sign and convert the values to numeric. However, the warning messages indicate that there are issues with coercion to numeric, possibly due to non-numeric values in the columns.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To handle this, you can modify your function to add additional checks to handle non-numeric values. Here's an updated version of your function:</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>remove_percentage_sign <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove percentage sign</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"%"</span>, <span class="st">""</span>, x)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to numeric, handling non-numeric values</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  numeric_values <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(x))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA values with 0 or handle them based on your specific use case</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  numeric_values[<span class="fu">is.na</span>(numeric_values)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(numeric_values)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Then, apply this modified function to your columns using `map_df`:</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming original_IFPI_data is your data frame</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>columns_to_process <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Physical"</span>, <span class="st">"Digital"</span>, <span class="st">"Performance Rights"</span>, <span class="st">"Synchronization"</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>original_IFPI_data[, columns_to_process] <span class="ot">&lt;-</span> <span class="fu">map_df</span>(</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  original_IFPI_data[, columns_to_process], </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">remove_percentage_sign</span>(.x)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># This modified function will attempt to convert values to numeric, and if it fails (resulting in NA), it will replace those NA values with 0. Adjust the replacement strategy based on your specific requirements. After applying this, check for NAs in your data to ensure that the warning messages are appropriately handled.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>While I did not utlize its solution (since I don’t plan to convert NA to 0), its explanation was helpful in making way for turning the columns to numeric.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#writing a function to remove % from observations and fix missing values by turning n/a to NA</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>remove_percentage_sign_fix_missing <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">'%'</span>, <span class="st">''</span>, x)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">==</span> <span class="st">"n/a"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#apply the remove_percentage_sign function to the following columns: Physical, Digital, Performance Rights, Synchronization </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)] <span class="ot">&lt;-</span> <span class="fu">map_df</span>(wrangled_IFPI_data[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)], remove_percentage_sign_fix_missing)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#I removed the line that converts values to numeric altogether. I fixed NA using the function learned in lecture 4. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When I tried to add a year column that decreases every 11 rows to IFPI dataframe, I found <a href="https://stackoverflow.com/questions/62513874/how-can-i-create-a-new-column-with-the-same-id-every-n-rows-in-r">this solution</a>. Chat GPT was able to explain each step to me so I can incorporate it into my data wrangling.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#explain every step of this to me</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>bloc_len <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bloc <span class="ot">&lt;-</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1</span> <span class="sc">+</span> <span class="fu">nrow</span>(df) <span class="sc">%/%</span> bloc_len), <span class="at">each =</span> bloc_len, <span class="at">length.out =</span> <span class="fu">nrow</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It gave a through explanation, introducing the usage of <code>rep</code> to me</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code generates a sequence of block identifiers and repeats it to match the length of the original data frame (df). Here's a step-by-step breakdown:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># seq(1, 1 + nrow(df) %/% bloc_len): This generates a sequence of integers starting from 1 up to the maximum block identifier. The 1 + nrow(df) %/% bloc_len calculates the maximum block identifier based on the total number of rows in the data frame (df) and the block length (bloc_len). %/% is the integer division operator.</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rep(..., each = bloc_len, length.out = nrow(df)): This repeats the sequence of block identifiers each times (in this case, bloc_len times) and ensures that the total length of the repeated sequence is equal to the number of rows in the original data frame (nrow(df)).</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># df$bloc &lt;- ...: Finally, the generated sequence of block identifiers is assigned to a new column called bloc in the original data frame df.</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#In summary, this code is creating a new column bloc in the data frame df where each block identifier is repeated bloc_len times, and the total length of the repeated sequence matches the number of rows in the original data frame. This is a way to group data into blocks of size bloc_len.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I produced the following code, which ran perfectly</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>year_len <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>original_IFPI_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">2017</span>, <span class="dv">1</span> <span class="sc">+</span> <span class="fu">nrow</span>(original_IFPI_data) <span class="sc">%/%</span> year_len), <span class="at">each =</span> year_len, <span class="at">length.out =</span> <span class="fu">nrow</span>(original_IFPI_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="adding-features-to-plot-exceedingly-helpful" class="level4">
<h4 class="anchored" data-anchor-id="adding-features-to-plot-exceedingly-helpful">3. adding features to plot: exceedingly helpful</h4>
<p>Using ChatGpt significantly improved my efficiency in modifying the details of graphs. For example, it help me set axis range based on my original code:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this code snippet is slightly different from the one I used in my visualisation, as I made the plot before I constructed the dashboard- so its from the early stage of my workflow.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I asked Chatgpt to set both axis to 100</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>IFPI_graph<span class="ot">=</span> IFPI_by_year<span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>physical_percentage, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y=</span>digital_percentage,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span>market,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span>retail_value_us_millions))<span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Global Music Market from 2011 to 2017"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">x=</span><span class="st">"Physical Percentage"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">y=</span><span class="st">"Digital Percentage"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">size=</span><span class="st">"Total retail Value in US$ millions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ChatGPT provided the following solution which worked perfectly:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To set both the x-axis and y-axis limits to 100 in your `IFPI_graph`, you can use the `scale_x_continuous()` and `scale_y_continuous()` functions in ggplot2. Here's how you can modify your code:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>IFPI_graph <span class="ot">&lt;-</span> IFPI_by_year <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> physical_percentage, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> digital_percentage,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> market,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> retail_value_us_millions)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Global Music Market from 2011 to 2017"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Physical Percentage"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Digital Percentage"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"Total retail Value in US$ millions"</span>) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>IFPI_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In another case, it came up with solutions to change the labels of the legend.Although its suggestion, mutating a new column is surprisingly simple, it was nevertheless effective.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># My original code:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tophits_uk <span class="ot">&lt;-</span> <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(tophits_uk, <span class="at">x =</span> <span class="sc">~</span>track.popularity, <span class="at">y =</span> <span class="sc">~</span>danceability, <span class="at">color =</span> <span class="sc">~</span>track.explicit, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">'blue'</span>, <span class="st">'red'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>()<span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Relationship between Popularity and Danceability"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"popularity"</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span> (<span class="at">title =</span> <span class="st">"danceability"</span>)) </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># I was looking for ways to change the display of the variable track.explicit to "explicit" and "non-explicit instead of true and false</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ChatGPT's solution:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># To change the display of the track.explicit variable to "explicit" and "non-explicit" instead of TRUE and FALSE in your plot_ly plot in R using plotly, you can use the mutate function to create a new column that maps TRUE to "explicit" and FALSE to "non-explicit". Here's an example:</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming tophits_uk is your data frame</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tophits_uk <span class="ot">&lt;-</span> tophits_uk <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">explicit_label =</span> <span class="fu">ifelse</span>(track.explicit, <span class="st">"explicit"</span>, <span class="st">"non-explicit"</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(tophits_uk, <span class="at">x =</span> <span class="sc">~</span>track.popularity, <span class="at">y =</span> <span class="sc">~</span>danceability, <span class="at">color =</span> <span class="sc">~</span>explicit_label, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">'blue'</span>, <span class="st">'red'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Relationship between Popularity and Danceability"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Popularity"</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Danceability"</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">colorbar =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Explicit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Although there are many times when ChatGPT failed to provide me with a runnable solution (roughly 8 out of 10 times the code won’t run), it was suitable for making simple refinements. Compared to solutions on stackoverflow or CRAN, its is tailored to my code and therefore saves the time compared to adapting internet solution to my own code.</p>
<p>I used the explanatory function of ChatGPT as a form of dictionary throughout the process, as it can breaks code chunks down into steps and explain each line. This function allowed me to continuously reinforce my memory of the coding language throughout the process of coding.</p>
</section>
</section>
</section>
<section id="part-iii-server-code-view-in-r-studio" class="level2">
<h2 class="anchored" data-anchor-id="part-iii-server-code-view-in-r-studio">Part III Server code (view in r studio)</h2>
<p>
<script type="application/shiny-prerendered" data-context="server-start">
#check whether groundhog is installed on the computer, install if not. Remove # to install
rm(list = ls())
if (!require("groundhog")) {
  install.packages("groundhog")
}

pkgs <- c(
  "spotifyr", #wrapper for spotify API
  "purrr", #for static data scraping
  "xml2",
  "rvest",
  "robotstxt",
  "tidyverse",#for data wrangling
  "dplyr",
  "countrycode",#for data visualisation
  "plotly",
  "tibble",
  "ggplot2",
  "janitor",
  "gifski",
  "kableExtra",
  "fmsb",
  "gganimate",
  "shinyanimate"
)


groundhog.library(pkgs, "2024-01-04")

</script>
 
<script type="application/shiny-prerendered" data-context="server">

# data wranglingtophits----
original_tophits <- read_csv("140123tophits.csv")

wrangled_tophits <- original_tophits %>%
  select(playlist_name, danceability, energy, key, loudness,speechiness, acousticness, instrumentalness, liveness, valence, tempo, track.explicit, track.popularity, track.name)%>%
  rename(country = playlist_name)#rename the playlist_name column to country

#Remove the "Top 50 -  "from the country column
wrangled_tophits$country <- gsub("Top 50 - ", "", wrangled_tophits$country)
#standardize the country names using countrycode package
wrangled_tophits$country <- ifelse(
  grepl("[A-Za-z]", wrangled_tophits$country),  # Check if there are letters
  countrycode(wrangled_tophits$country, origin = 'country.name', destination = 'country.name.en'),
  countrycode(wrangled_tophits$country, origin = 'iso2c', destination = 'country.name.en')
)
# data wrangling IFPI---- 
original_IFPI_data <- read_csv("140123original_IFPI_data.csv")
#adding year column 
year_len <- 11
original_IFPI_data$year <- rep(seq(2017, 1 + nrow(original_IFPI_data) %/% year_len), each = year_len, length.out = nrow(original_IFPI_data))
#exporting IFPI data as scraped on 14 Jan 2024 for reproducibility
write_csv(original_IFPI_data,"140123Original_IFPI_data.csv")

#remove `% Change` column, which is all NA
wrangled_IFPI_data <- original_IFPI_data %>%
  select(!`% Change`)

#removing "," from the `Retail valueUS$ (millions)` column to convert it to numeric value
wrangled_IFPI_data$`Retail valueUS$ (millions)` <- gsub(',', '', wrangled_IFPI_data$`Retail valueUS$ (millions)`)

#writing a function to remove % from observations and fix missing values by turning n/a to NA
remove_percentage_sign_fix_missing <- function(x){
  x <- gsub('%', '', x)
  x[x == "n/a"] <- NA
  x
}
#apply the remove_percentage_sign function to the following columns: Physical, Digital, Performance Rights, Synchronization 
wrangled_IFPI_data[,c(4:7)] <- purrr::map_df(wrangled_IFPI_data[,c(4:7)], remove_percentage_sign_fix_missing)

#change column 4-7 to numeric
wrangled_IFPI_data[,c(4:7)] <- purrr::map_df(wrangled_IFPI_data[,c(4:7)], as.numeric)

#change the column name by adding 'percentage' to the end of column 4-7
colnames(wrangled_IFPI_data)[4:7] <- paste(colnames(wrangled_IFPI_data)[4:7],' percentage')
#use janitor to clean the column names
wrangled_IFPI_data <- janitor::clean_names(wrangled_IFPI_data)

##standardize the country names using countrycode package
wrangled_IFPI_data$market <- ifelse(
  grepl("[A-Za-z]", wrangled_IFPI_data$market),  # Check if there are letters
  countrycode(wrangled_IFPI_data$market, origin = 'country.name', destination = 'country.name.en'),
  countrycode(wrangled_IFPI_data$market, origin = 'iso2c', destination = 'country.name.en')
)
#make retail_value_us_millions column numeric
wrangled_IFPI_data$retail_value_us_millions <- as.numeric(wrangled_IFPI_data$retail_value_us_millions)
#remove the rows with NA in market column
wrangled_IFPI_data <- wrangled_IFPI_data[!is.na(wrangled_IFPI_data$market),]

# remove NA rows in market column and subsetting the data to a new dataframe called global_IFPI_data
global_IFPI_data <- wrangled_IFPI_data %>%
  filter(is.na(market))%>%
  select(year,retail_value_us_millions)

#change the retail_value_us_millions column to numeric
global_IFPI_data$retail_value_us_millions <- as.numeric(global_IFPI_data$retail_value_us_millions)

global_IFPI_data$year <- as.numeric(global_IFPI_data$year)



#static Market plot----
output$musicmarket <- renderPlot({
  
  IFPI_by_year <- wrangled_IFPI_data %>%
  filter(!is.na(market)) %>%
  filter(year == input$yearslider) 
  
  IFPI_graph= IFPI_by_year%>%
  ggplot(aes(x=physical_percentage, 
             y=digital_percentage,
             color=market,
             size=retail_value_us_millions))+
  geom_point()+
  labs(title="3.Global Music Market from 2011 to 2017",
       x="Physical Percentage",
       y="Digital Percentage",
       size="Total retail Value in US$ millions")+
  scale_x_continuous(limits = c(0, 100)) +
  scale_y_continuous(limits = c(0, 100))+theme_minimal()
IFPI_graph
})

output$radar_chart <- renderPlot({

  # some data wrangling to calculate the means
  radar_uk_tophits <- wrangled_tophits %>%
    filter(country == input$radar_country) %>%
    select(danceability, energy, liveness, valence, acousticness)

  radar_uk_tophits_mean <- radar_uk_tophits %>%
    summarise_all(mean)

  # Add min and max for radar plot
  radar_uk_tophits_mean <- rbind(radar_uk_tophits_mean, rep(1))
  radar_uk_tophits_mean <- rbind(radar_uk_tophits_mean, rep(0))

  # Move the third row to the first row - so that max and min are in the front, ready for plotting radar chart
  radar_uk_tophits_mean <- radar_uk_tophits_mean[c(3, 2, 1),]

 
  colors_fill <- c(scales::alpha("orchid", 0.1))
  colors_line <- c(scales::alpha("orchid4", 0.5))

  
  radarchart(
    radar_uk_tophits_mean,
    seg = 5,axistype = 1,
pcol = colors_fill, pfcol = colors_line, plwd = 4, plty = 1,cglcol = "grey", cglty = 1, axislabcol = "hotpink", caxislabels = seq(0, 1, 0.1), cglwd = 1,vlcex = 0.8,
title=paste("2.Characteristic of tophits in different country")
  )

})


radarchart4d <- reactive({
  
  # some data wrangling to calculate the means
  radar_uk_tophits <- wrangled_tophits %>%
    filter(country == input$radar_country) %>%
    select(danceability, energy, liveness, valence, acousticness)

  radar_uk_tophits_mean <- radar_uk_tophits %>%
    summarise_all(mean)

  # Add min and max for radar plot
  radar_uk_tophits_mean <- rbind(radar_uk_tophits_mean, rep(1))
  radar_uk_tophits_mean <- rbind(radar_uk_tophits_mean, rep(0))

  # Move the third row to the first row - so that max and min are in the front, ready for plotting radar chart
  radar_uk_tophits_mean <- radar_uk_tophits_mean[c(3, 2, 1),]

 
  colors_fill <- c(scales::alpha("orchid", 0.1))
  colors_line <- c(scales::alpha("orchid4", 0.5))

  
  radarchart(
    radar_uk_tophits_mean,
    seg = 5,axistype = 1,
pcol = colors_fill, pfcol = colors_line, plwd = 4, plty = 1,cglcol = "grey", cglty = 1, axislabcol = "hotpink", caxislabels = seq(0, 1, 0.1), cglwd = 1,vlcex = 0.8,
title=paste("2.Characteristic of tophits in different country")
  )
  
})










# this part is refined by chatGPT. My original code was base on https://community.rstudio.com/t/shiny-download-ggplot/90532/2 which did not ran successfully the first few times. 
output$downloadRadar <- downloadHandler(
    filename = function() {
      paste("radar_chart_", input$radar_country, ".png", sep = "")
    },
    content = function(file) {
      # Save the radar chart as a PNG file
      png(file)
      print(radarchart4d())  # Redraw the radar chart
      dev.off()
    }
  )





# ploting audio feature-----
tophits_choosen <- reactive({
    wrangled_tophits %>%
      filter(country == input$country_buttons) %>%
      mutate(explicit_label = ifelse(track.explicit, "explicit", "non-explicit"))
  })

output$audio_features <- renderPlotly({
  p<-plot_ly(tophits_choosen(), 
        x = ~track.popularity, 
        y = ~get(input$Yvar), 
        color = ~explicit_label, 
        colors = c('orchid', 'royalblue'),text=~track.name, hoverinfo="text") %>%
  layout(title = "1.Relationship between Popularity and different audio features",
         xaxis = list(title = "popularity", range = c(50, 100)),
         yaxis = list (title = input$Yvar, range = c(0,1)))
  p
})



</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["kePrint"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["kePrint-0.0.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["kePrint.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["lightable"]},{"type":"character","attributes":{},"value":["0.0.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lightable-0.0.1"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["lightable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["kableExtra"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.3.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"character","attributes":{},"value":["1.6.4"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["htmlwidgets"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.6.4"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["plotly-binding"]},{"type":"character","attributes":{},"value":["4.10.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["htmlwidgets"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["plotly.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["plotly"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["4.10.3"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["selectize"]},{"type":"character","attributes":{},"value":["0.15.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/selectize"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/selectize.min.js","accessibility/js/selectize-plugin-a11y.min.js"]},{"type":"character","attributes":{},"value":["css/selectize.bootstrap3.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.8.0"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.8.0"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98]}},"value":[{"type":"character","attributes":{},"value":["assertthat","base","bit","bit64","bslib","cachem","cli","colorspace","compiler","countrycode","crayon","data.table","datasets","digest","dplyr","ellipsis","evaluate","fansi","farver","fastmap","fmsb","forcats","generics","gganimate","ggplot2","gifski","glue","graphics","grDevices","grid","groundhog","gtable","highr","hms","htmltools","htmlwidgets","httpuv","httr","janitor","jquerylib","jsonlite","kableExtra","knitr","later","lazyeval","lifecycle","lubridate","magrittr","memoise","methods","mime","munsell","parallel","pillar","pkgconfig","plotly","prettyunits","progress","promises","purrr","R6","Rcpp","readr","rlang","rmarkdown","robotstxt","rstudioapi","rvest","sass","scales","shiny","shinyanimate","snakecase","spotifyr","stats","stringi","stringr","svglite","systemfonts","tibble","tidyr","tidyselect","tidyverse","timechange","tools","tweenr","tzdb","utf8","utils","vctrs","viridisLite","vroom","webshot","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","4.3.1","4.0.5","4.0.5","0.6.1","1.0.8","3.6.2","2.1-0","4.3.1","1.5.0","1.5.2","1.14.10","4.3.1","0.6.33","1.1.4","0.3.2","0.23","1.0.6","2.1.1","1.1.1","0.7.5","1.0.0","0.1.3","1.0.8","3.4.4","1.12.0-2","1.6.2","4.3.1","4.3.1","4.3.1","3.1.2","0.3.4","0.10","1.1.3","0.5.7","1.6.4","1.6.13","1.4.7","2.2.0","0.1.4","1.8.8","1.3.4","1.45","1.3.2","0.2.2","1.0.4","1.9.3","2.0.3","2.0.1","4.3.1","0.12","0.5.0","4.3.1","1.9.0","2.0.3","4.10.3","1.2.0","1.2.3","1.2.1","1.0.2","2.5.1","1.0.11","2.1.4","1.1.2","2.25","0.7.13","0.15.0","1.0.3","0.4.8","1.3.0","1.8.0","0.4.0","0.11.1","2.2.4","4.3.1","1.8.3","1.5.1","2.1.3","1.0.5","3.2.1","1.3.0","1.2.0","2.0.0","0.2.0","4.3.1","2.0.2","0.4.0","1.2.4","4.3.1","0.6.5","0.4.2","1.6.5","0.5.5","2.5.2","0.41","1.3.6","1.8-4","2.3.8"]}]}]}
</script>
<!--/html_preserve-->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-aarons2018" class="csl-entry" role="listitem">
Aarons, Haydn. 2018. <span>“Moral Distinction: Religion, Musical Taste and the Moral Cultural Consumer.”</span> <em>Journal of Consumer Culture</em> 21 (2): 296–316. <a href="https://doi.org/10.1177/1469540518787584">https://doi.org/10.1177/1469540518787584</a>.
</div>
<div id="ref-geurts2023" class="csl-entry" role="listitem">
Geurts, Amber, and Katharina Cepa. 2023. <span>“Transforming the Music Industry: How Platformization Drives Business Ecosystem Envelopment.”</span> <em>Long Range Planning</em> 56 (4): 102327. <a href="https://doi.org/10.1016/j.lrp.2023.102327">https://doi.org/10.1016/j.lrp.2023.102327</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>